## å‰è¨€

è¿™æ˜¯é¡¹ç›®ç§ä¿¡ç³»ç»Ÿçš„websocketçš„ç›¸å…³è¯´æ˜Žï¼š

ç†æ¸…æ¦‚å¿µï¼š

ðŸ·ï¸ åœ¨websocketé‡Œé¢ï¼Œå‰ç«¯å¯ä»¥å’ŒåŽå°äº’ç›¸æ²Ÿé€šäº¤æµï¼Œè¿™é‡Œå°†å‰ç«¯å‘ç»™åŽå°çš„æ¶ˆæ¯åŒ…ç§°ä¸ºrequeståŒ…

åŽå°å‘ç»™å‰ç«¯çš„åŒ…ç§°ä¸ºresponseåŒ…ï¼›

ðŸ·ï¸ websocktçš„å¤§è‡´æµç¨‹ä¸ºï¼šå»ºç«‹è¿žæŽ¥â€”>å‘é€æ¶ˆæ¯->æŽ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚åˆ°æœ€åŽå‰ç«¯ç›´æŽ¥å…³é—­è¿žæŽ¥å³ä¸ºç»“æŸã€‚



## å»ºç«‹è¿žæŽ¥

URL: 120.77.242.172:8080/teaching/imserver/{userId} å…¶ä¸­userIdä¸ºç”¨æˆ·ID

 âš ï¸ æ³¨æ„ è¿™é‡Œä¹‹åŽä¼šå°†userIDæ¢æˆjwtçš„token å¾…å®žéªŒè¿™æ ·æ˜¯å¦å¯è¡Œ

ðŸ·ï¸ åŽŸå› ï¼šå› ä¸ºç›®å‰æœ‰éšæ‚£ï¼Œå¦‚æžœéšæ„ä¸€ä¸ªäººä½¿ç”¨ä¸€ä¸ªå‡çš„userIDéšæ„å¯ä»¥ä¼ªè£…ä¸ºIDä¸ºxxçš„äººå’ŒåŽå°è¿›è¡Œäº¤äº’ï¼Œæžä¸å®‰å…¨ï¼Œç­‰å‰ç«¯æ­å»ºå®Œç§ä¿¡ç³»ç»Ÿä¹‹åŽï¼ŒåŽå°å†è¿›è¡Œè€ƒè™‘å’Œä¿®æ”¹ã€‚

## å‘é€æ¶ˆæ¯

æ¶ˆæ¯requestçš„æ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "fromId": 1, //å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ID
  "toId": 2, //æŽ¥å—æ¶ˆæ¯çš„ç”¨æˆ·ID 
  "type": 0, // æ¶ˆæ¯ç±»åž‹ å…¶ä¸­ å‘é€ç§ä¿¡çš„typeä¸º0 ç¡®è®¤æ¶ˆæ¯å·²è¯»çš„typeä¸º1;
  "content": "ä½ å¥½", //æ¶ˆæ¯çš„æ–‡æœ¬å†…å®¹
  "timestamp": "1589790567", //æ—¶é—´æˆ³ï¼Œéœ€è¦å‰ç«¯æž„å»º
  "Describe": "" //æ‰©å±•å­—æ®µï¼Œé’ˆå¯¹ä¸åŒç±»åž‹çš„åŒ…è¿›è¡Œè€Œå¤–æ‰©å±•ï¼Œåœ¨æ­¤å¤„ä¸ºç©º
}
```

å‘è¿žæŽ¥å‘é€æ¶ˆæ¯åŽï¼Œè‹¥æ¶ˆæ¯åŽå°æŽ¥æ”¶æˆåŠŸï¼Œåˆ™ä¼šè¿”å›žresponseåŒ…

```json
{
  "fromId": 0, //æ¶ˆæ¯æ¥è‡ªå“ªä¸ªç”¨æˆ· ç³»ç»ŸIDä¸º0 
  "toId": 1, //æŽ¥æ”¶è¿™ä¸ªæ¶ˆæ¯çš„ç”¨æˆ·ID
  "type": 0, // responseçš„typeç±»åž‹ï¼Œæœ‰ä¸‰ç§ã€‚å…¶ä¸­0ä½å“åº”æˆåŠŸåŒ…ï¼Œç”¨äºŽå‘å‘é€ç§ä¿¡çš„ç”¨æˆ·å‘é€æˆåŠŸçš„æç¤ºï¼›1ä½å“åº”å¤±è´¥åŒ…ï¼Œæš‚æ—¶ç”¨ä¸ä¸Šï¼›2ä¸ºæ¶ˆæ¯åŒ…ï¼Œå³æ”¶åˆ°äº†æ¥è‡ªå…¶ä»–ç”¨æˆ·çš„ç§ä¿¡
  "content": "", //ç§ä¿¡ï¼ˆæ¶ˆæ¯ï¼‰çš„æ–‡æœ¬å†…å®¹ï¼Œæ­¤å¤„ä¼šä¸ºç©º
  "timestamp": "1589790567", //æ—¶é—´æˆ³ï¼Œç”¨æ¥å‰ç«¯åŒºåˆ†ç§ä¿¡é¡ºåº
  "Describe": "" // æ‰©å±•å­—æ®µ
}
```

 âš ï¸ æ³¨æ„ï¼Œè‹¥å‰ç«¯åœ¨å‘å®Œæ¶ˆæ¯çš„6ç§’ï¼ˆæš‚å®šä¸º6ç§’ï¼‰å†…æ²¡æœ‰æ”¶åˆ°ä¸Šè¿°çš„responseåŒ…æ—¶ï¼Œè¯´æ˜Žæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ­¤æ—¶å¯ä»¥é‡è¯•3æ¬¡ï¼Œä¸‰æ¬¡å¤±è´¥æé†’ç”¨æˆ·å‘é€å¤±è´¥ã€‚

æ•ˆæžœå¦‚ä¸‹ï¼š

![å‘é€æ¶ˆæ¯æ•ˆæžœ](https://raw.githubusercontent.com/carrymaniac/pic/master/20200518200150.png)

å½“æ”¶åˆ°è¯¥åŒ…æ—¶ï¼Œè¯´æ˜Žæ¶ˆæ¯å‘é€æˆåŠŸï¼Œæ­¤æ—¶å¯ä»¥å°†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šã€‚



## æŽ¥æ”¶æ¶ˆæ¯

å½“ç”¨æˆ·æŽ¥æ”¶åˆ°åˆ«äººå‘æ¥çš„ç§ä¿¡çš„æ—¶å€™ï¼ŒresponseåŒ…æ ¼å¼å¦‚ä¸‹ï¼š

```json

{
  "fromId": 1, //æ¶ˆæ¯æ¥è‡ªå“ªä¸ªç”¨æˆ· æ­¤å¤„è¡¨ç¤ºIDä¸º1çš„ç”¨æˆ·å‘æ¥äº†æ¶ˆæ¯
  "toId": 2, //æŽ¥æ”¶è¿™ä¸ªæ¶ˆæ¯çš„ç”¨æˆ·ID
  "type": 2, // responseçš„typeç±»åž‹ï¼Œæœ‰ä¸‰ç§ã€‚å…¶ä¸­0ä½å“åº”æˆåŠŸåŒ…ï¼Œç”¨äºŽå‘å‘é€ç§ä¿¡çš„ç”¨æˆ·å‘é€æˆåŠŸçš„æç¤ºï¼›1ä½å“åº”å¤±è´¥åŒ…ï¼Œæš‚æ—¶ç”¨ä¸ä¸Šï¼›2ä¸ºæ¶ˆæ¯åŒ…ï¼Œå³æ”¶åˆ°äº†æ¥è‡ªå…¶ä»–ç”¨æˆ·çš„ç§ä¿¡
  "content": "ä½ å¥½", //ç§ä¿¡ï¼ˆæ¶ˆæ¯ï¼‰çš„æ–‡æœ¬å†…å®¹
  "timestamp": "1589790567", //æ—¶é—´æˆ³ï¼Œç”¨æ¥å‰ç«¯åŒºåˆ†ç§ä¿¡é¡ºåº
  "Describe": "form" // æ‰©å±•å­—æ®µï¼Œæ‰©å±•å­—æ®µä¼šä»¥æ™®é€šçš„JSONå­—ç¬¦ä¸²å­˜å‚¨ï¼Œéœ€è¦å‰ç«¯å–å‡ºå¹¶è½¬æ¢ã€‚åœ¨æ­¤æƒ…å†µä¼šæœ‰ä¸‰ä¸ªæ‰©å±•å­—æ®µä¸ºï¼š
  {
  "userName":"å°æ˜Ž" //ç§ä¿¡å‘é€è€…çš„åå­—
  "headURL":"www.baidu.com" //ç§ä¿¡å‘é€è€…çš„å¤´åƒ
  "messageId":"2323" //ç§ä¿¡çš„ID
	}
}
```

å‰ç«¯æ˜¾ç¤ºè¯¥æ¡æ¶ˆæ¯

 âš ï¸ æ³¨æ„ï¼Œå½“ç”¨æˆ·ï¼ˆ72ï¼‰çœ‹åˆ°71å‘æ¥çš„è¯¥æ¡æ¶ˆæ¯ä¹‹åŽï¼Œå‰ç«¯éœ€è¦å‘åŽå°å‘é€ä¸€ä¸ªç¡®è®¤åŒ…ï¼Œä»¥ç¡®è®¤æ¶ˆæ¯å·²ç»æˆåŠŸè¢«ç”¨æˆ·é˜…è¯»ï¼Œæ­¤æ—¶åŒ…æ ¼å¼å¦‚ä¸‹:

```json
{
  "fromId": 1, //å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ID
  "toId": 0, //æŽ¥å—æ¶ˆæ¯çš„ç”¨æˆ·ID 0å³ç³»ç»Ÿ
  "type": 1, // æ¶ˆæ¯ç±»åž‹ å…¶ä¸­ å‘é€ç§ä¿¡çš„typeä¸º0 ç¡®è®¤æ¶ˆæ¯å·²è¯»çš„typeä¸º1;
  "content": "[12,13,14]", //éœ€è¦ç¡®è®¤å·²è¯»çš„æ¶ˆæ¯ID ï¼Œä»¥Arrayçš„å½¢å¼å­˜å‚¨ä¸ºå­—ç¬¦ä¸² æ”¾åœ¨contentä¸­
  "timestamp": "1589790567", //æ—¶é—´æˆ³ï¼Œéœ€è¦å‰ç«¯æž„å»º
  "Describe": "" //æ‰©å±•å­—æ®µï¼Œé’ˆå¯¹ä¸åŒç±»åž‹çš„åŒ…è¿›è¡Œè€Œå¤–æ‰©å±•ï¼Œåœ¨æ­¤å¤„ä¸ºç©º
}
```

æ­¤ç¡®è®¤requestä¸ä¼šæœ‰responseæ¥å“åº”å‘é€æˆåŠŸï¼Œå› æ­¤é™é»˜å‘é€å³å¯ã€‚









A  -> server 

B -> server



A -> B

